name: ffmpeg
modules:
- name: svt-av1
  buildsystem: cmake-ninja
  builddir: true
  sources:
    - type: git
      url: https://gitlab.com/AOMediaCodec/SVT-AV1.git
      tag: v3.1.2

- name: libx264
  config-opts:
    - --disable-cli
    - --enable-shared
  sources:
    - type: git
      url: https://code.videolan.org/videolan/x264.git
      commit: ab393c85eb23c522684d2494a8a5665cebc315a9

- name: x265
  buildsystem: cmake-ninja
  builddir: true
  subdir: source
  config-opts:
    - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    - -DCMAKE_POSITION_INDEPENDENT_CODE=ON
    - -DENABLE_SHARED=ON
    - -DENABLE_CLI=OFF
  sources:
    - type: archive
      url: https://deb.debian.org/debian/pool/main/x/x265/x265_4.1.orig.tar.xz
      sha256: 85abb8a850000bf693947459c42a666a3ecd6de10a2ac6b3c6647554b14d3270
    - type: patch
      path: ../patches/x265_set-minimum-cmake-version-to-3.10.patch

- name: ffmpeg
  config-opts:
    - --enable-shared
    - --disable-static
    - --disable-doc
    - --disable-manpages
    - --disable-stripping
    - --disable-ffplay
    - --disable-ffprobe

    - --enable-gpl
    - --enable-version3
    - --enable-optimizations
    - --enable-pthreads
    - --enable-gnutls
    - --enable-libxcb-xfixes
    - --enable-opengl
    - --enable-opencl
    - --enable-sdl2
    - --enable-vaapi
    - --enable-vdpau
    - --enable-zlib
    - --enable-bzlib
    - --enable-lzma

    - --enable-fontconfig
    - --enable-libfontconfig
    - --enable-libfreetype
    - --enable-libxml2

    - --enable-avcodec
    - --enable-avfilter
    - --enable-swscale

    - --enable-libxcb
    - --enable-protocol=file

    # Codecs we need / want: FFV1, AV1, VP9, H.264, HEVC
    - --enable-libsvtav1
    - --enable-libvpx
    - --enable-libx264
    - --enable-libx265
  cleanup:
    - /share/ffmpeg/examples
  sources:
    - type: archive
      url: https://ffmpeg.org/releases/ffmpeg-7.1.3.tar.xz
      sha256: f0bf043299db9e3caacb435a712fc541fbb07df613c4b893e8b77e67baf3adbe
    - type: patch
      path: ../patches/ffmpeg_svtav1-api-fix.patch
